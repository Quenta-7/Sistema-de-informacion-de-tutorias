<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Tutor√≠as UNSAAC</title>
    <!-- Carga de Tailwind CSS para estilos modernos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Aplicamos la fuente Inter y centramos el contenido */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Un fondo gris claro agradable */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        /* Estilos espec√≠ficos para la tarjeta de login */
        #login-container {
            max-width: 400px;
            width: 90%;
            transition: all 0.3s ease;
        }
        /* Estilo para el input de error (usado por JS) */
        .input-error {
            border-color: #ef4444; /* Rojo de Tailwind 500 */
        }
    </style>
</head>
<body class="p-4">
    <div id="login-container" class="bg-white p-8 md:p-10 rounded-xl shadow-2xl space-y-6">
        
        <!-- Encabezado de la Aplicaci√≥n -->
        <header class="text-center space-y-2">
            <!-- Icono de la UNSAAC o de Tutor√≠a -->
            <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 text-blue-700 mx-auto" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zm0 13l-10-5v6l10 5 10-5v-6l-10 5zm0-3l-7-3.5 7-3.5 7 3.5-7 3.5z"/>
            </svg>
            <h1 class="text-2xl font-bold text-gray-800">Sistema de Tutor√≠as</h1>
            <p class="text-sm text-gray-500">Ingenier√≠a Inform√°tica y de Sistemas - UNSAAC</p>
        </header>

        <!-- Formulario de Login -->
        <form id="login-form" class="space-y-4">
            
            <div>
                <label for="tutor_id" class="block text-sm font-medium text-gray-700 mb-1">ID de Usuario (tutor_id)</label>
                <input 
                    type="text" 
                    id="tutor_id" 
                    name="tutor_id" 
                    required 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                    placeholder="Escriba su ID de tutor/usuario"
                >
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    required 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                >
            </div>
            
            <!-- Mensaje de estado (√©xito/error) -->
            <p id="message" class="text-center text-sm font-semibold h-4"></p>

            <button 
                type="submit" 
                id="login-button"
                class="w-full py-2.5 rounded-lg bg-blue-600 text-white font-semibold shadow-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-200 disabled:opacity-50"
            >
                Iniciar Sesi√≥n
            </button>
        </form>
        
        <footer class="text-center pt-4">
            <p class="text-xs text-gray-400">Desarrollo Semestral IF611A/B</p>
        </footer>
    </div>

    <script>
        // L√≥gica de JavaScript para manejar el login y la comunicaci√≥n con Flask
        document.getElementById('login-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // Previene el env√≠o tradicional del formulario

            const tutorIdInput = document.getElementById('tutor_id');
            const passwordInput = document.getElementById('password');
            const messageElement = document.getElementById('message');
            const loginButton = document.getElementById('login-button');

            // Limpiar mensajes y estilos anteriores
            messageElement.textContent = ''; 
            messageElement.className = 'text-center text-sm font-semibold h-4';
            tutorIdInput.classList.remove('input-error');
            passwordInput.classList.remove('input-error');

            loginButton.disabled = true;
            loginButton.textContent = 'Verificando...';
            
            const tutor_id = tutorIdInput.value;
            const password = passwordInput.value;

            try {
                // ** IMPORTANTE: Aseg√∫rate de que tu servidor Flask est√© corriendo en el puerto 5000 **
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tutor_id, password })
                });

                const result = await response.json();

                if (response.ok) {
                    messageElement.classList.add('text-green-600');
                    messageElement.textContent = `¬°Bienvenido! Rol: ${result.user.rol}`;
                    loginButton.textContent = '√âxito';
                    // *** AQU√ç DEBES REDIRECCIONAR AL DASHBOARD ***
                    // window.location.href = 'dashboard.html'; 
                } else {
                    messageElement.classList.add('text-red-600');
                    messageElement.textContent = result.message || 'Error en la autenticaci√≥n.';
                    tutorIdInput.classList.add('input-error');
                    passwordInput.classList.add('input-error');
                    loginButton.textContent = 'Iniciar Sesi√≥n';
                }
            } catch (error) {
                console.error('Error de conexi√≥n con el servidor:', error);
                messageElement.classList.add('text-red-600');
                messageElement.textContent = 'Error: No se pudo conectar al servidor Flask (Puerto 5000).';
                loginButton.textContent = 'Iniciar Sesi√≥n';
            } finally {
                loginButton.disabled = false;
            }
        });
    </script>
    <!-- üîó Enlazamos el archivo JS externo -->
  <script src="main.js"></script>
</body>
</html>
